#!/usr/bin/env bash

assert_installed uuidgen jq
assert_defined TODOIST_TOKEN

user_input=$(echo '' | rofimenu -l 0 -p "⬜ ")

[[ -z "$user_input" ]] && exit 1

resp=$(curl --silent https://api.todoist.com/rest/v2/tasks \
    --data "{\"content\": \"$user_input\"}" \
    -H 'Content-Type: application/json' \
    -H "X-Request-Id: $(uuidgen)" \
    -H "Authorization: Bearer $TODOIST_TOKEN")

if [ $? -eq 0 ]; then
    echo $resp | jq '.id' && notify-send -i " " "📝 Task Added" "$user_input"
    exit 0
else
    notify-send -u critical "Couldn't add task to Todoist"
    exit 1
fi
